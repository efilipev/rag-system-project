---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "rag-system.fullname" . }}-config
  namespace: {{ .Values.global.namespace }}
  labels:
    {{- include "rag-system.labels" . | nindent 4 }}
data:
  # Logging
  LOG_LEVEL: {{ .Values.config.logLevel | quote }}

  # Embedding Configuration
  EMBEDDING_MODEL: {{ .Values.config.embeddingModel | quote }}
  VECTOR_DIMENSION: {{ .Values.config.vectorDimension | quote }}

  # Database
  POSTGRES_DB: "ragdb"
  POSTGRES_HOST: "postgres-service"
  POSTGRES_PORT: "5432"

  # Redis
  REDIS_HOST: "redis-service"
  REDIS_PORT: "6379"
  REDIS_DB: "0"

  # RabbitMQ
  RABBITMQ_HOST: "rabbitmq-service"
  RABBITMQ_PORT: "5672"

  # Qdrant
  QDRANT_HOST: "qdrant-service"
  QDRANT_PORT: "6333"

  # MinIO
  MINIO_ENDPOINT: "minio-service:9000"
  MINIO_BUCKET: "documents"

  # Service URLs
  QUERY_ANALYSIS_URL: "http://query-analysis-service:{{ .Values.queryAnalysis.service.port }}"
  DOCUMENT_RETRIEVAL_URL: "http://document-retrieval-service:{{ .Values.documentRetrieval.service.port }}"
  DOCUMENT_RANKING_URL: "http://document-ranking-service:{{ .Values.documentRanking.service.port }}"
  LATEX_PARSER_URL: "http://latex-parser-service:{{ .Values.latexParser.service.port }}"
  LLM_GENERATION_URL: "http://llm-generation-service:{{ .Values.llmGeneration.service.port }}"
  RESPONSE_FORMATTER_URL: "http://response-formatter-service:{{ .Values.responseFormatter.service.port }}"

  # Security
  ENABLE_AUTHENTICATION: {{ .Values.config.security.enableAuthentication | quote }}
  ENABLE_RATE_LIMITING: {{ .Values.config.security.enableRateLimiting | quote }}
  ENABLE_SECURITY_HEADERS: {{ .Values.config.security.enableSecurityHeaders | quote }}

  # CORS
  CORS_ALLOWED_ORIGINS: {{ .Values.config.cors.allowedOrigins | toJson | quote }}
  CORS_ALLOW_CREDENTIALS: {{ .Values.config.cors.allowCredentials | quote }}

  # JWT
  JWT_ALGORITHM: {{ .Values.config.jwt.algorithm | quote }}
  ACCESS_TOKEN_EXPIRE_MINUTES: {{ .Values.config.jwt.accessTokenExpireMinutes | quote }}
  REFRESH_TOKEN_EXPIRE_DAYS: {{ .Values.config.jwt.refreshTokenExpireDays | quote }}

  # Rate Limiting
  RATE_LIMIT_REQUESTS_PER_MINUTE: {{ .Values.config.rateLimit.requestsPerMinute | quote }}
  RATE_LIMIT_BURST: {{ .Values.config.rateLimit.burst | quote }}

  # LLM Configuration
  LLM_PROVIDER: {{ .Values.config.llm.provider | quote }}
  DEFAULT_MODEL: {{ .Values.config.llm.defaultModel | quote }}
  LLM_MAX_TOKENS: {{ .Values.config.llm.maxTokens | quote }}
  LLM_TEMPERATURE: {{ .Values.config.llm.temperature | quote }}

  # Ranking
  RANKER_TYPE: {{ .Values.config.ranking.type | quote }}
  CROSS_ENCODER_DEVICE: {{ .Values.config.ranking.device | quote }}
